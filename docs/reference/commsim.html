<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create an Object for Null Model Algorithms — commsim • vegan</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create an Object for Null Model Algorithms — commsim"><meta name="description" content="The commsim function can be used to feed Null Model algorithms into
nullmodel analysis.
The make.commsim function returns various predefined algorithm types
(see Details).
These functions represent low level interface for community null model
infrastructure in vegan with the intent of extensibility,
and less emphasis on direct use by users."><meta property="og:description" content="The commsim function can be used to feed Null Model algorithms into
nullmodel analysis.
The make.commsim function returns various predefined algorithm types
(see Details).
These functions represent low level interface for community null model
infrastructure in vegan with the intent of extensibility,
and less emphasis on direct use by users."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">vegan</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.6-7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/FAQ-vegan.html">Vegan FAQ</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/vegandevs/vegan/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create an Object for Null Model Algorithms</h1>

      <div class="d-none name"><code>commsim.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>commsim</code> function can be used to feed Null Model algorithms into
<code><a href="nullmodel.html">nullmodel</a></code> analysis.
The <code>make.commsim</code> function returns various predefined algorithm types
(see Details).
These functions represent low level interface for community null model
infrastructure in <span class="pkg">vegan</span> with the intent of extensibility,
and less emphasis on direct use by users.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">commsim</span><span class="op">(</span><span class="va">method</span>, <span class="va">fun</span>, <span class="va">binary</span>, <span class="va">isSeq</span>, <span class="va">mode</span><span class="op">)</span></span>
<span><span class="fu">make.commsim</span><span class="op">(</span><span class="va">method</span><span class="op">)</span></span>
<span><span class="co"># S3 method for class 'commsim'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character, name of the algorithm.</p></dd>

  <dt id="arg-fun">fun<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>A function. For possible formal arguments of this function
see Details.</p></dd>

  <dt id="arg-binary">binary<a class="anchor" aria-label="anchor" href="#arg-binary"></a></dt>
<dd><p>Logical, if the algorithm applies to presence-absence or count matrices.</p></dd>

  <dt id="arg-isseq">isSeq<a class="anchor" aria-label="anchor" href="#arg-isseq"></a></dt>
<dd><p>Logical, if the algorithm is sequential (needs burnin and thinning) or not.</p></dd>

  <dt id="arg-mode">mode<a class="anchor" aria-label="anchor" href="#arg-mode"></a></dt>
<dd><p>Character, storage mode of the community matrix, either
<code>"integer"</code> or <code>"double"</code>.</p></dd>

  <dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An object of class <code>commsim</code>.</p></dd>

  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function <code>fun</code> must return an array of <code>dim(nr, nc, n)</code>,
and must take some of the following arguments:</p><dl><dt><code>x</code>: </dt>
<dd><p>input matrix,</p></dd>

  <dt><code>n</code>: </dt>
<dd><p>number of permuted matrices in output,</p></dd>

  <dt><code>nr</code>: </dt>
<dd><p>number of rows,</p></dd>

  <dt><code>nc</code>: </dt>
<dd><p>number of columns,</p></dd>

  <dt><code>rs</code>: </dt>
<dd><p>vector of row sums,</p></dd>

  <dt><code>cs</code>: </dt>
<dd><p>vector of column sums,</p></dd>

  <dt><code>rf</code>: </dt>
<dd><p>vector of row frequencies (non-zero cells),</p></dd>

  <dt><code>cf</code>: </dt>
<dd><p>vector of column frequencies (non-zero cells),</p></dd>

  <dt><code>s</code>: </dt>
<dd><p>total sum of <code>x</code>,</p></dd>

  <dt><code>fill</code>: </dt>
<dd><p>matrix fill (non-zero cells),</p></dd>

  <dt><code>thin</code>: </dt>
<dd><p>thinning value for sequential algorithms,</p></dd>

  <dt><code>...</code>: </dt>
<dd><p>additional arguments.</p></dd>


</dl><p>You can define your own null model, but
  several null model algorithm are pre-defined and can be called by
  their name. The predefined algorithms are described in detail in the
  following chapters. The binary null models produce matrices of zeros
  (absences) and ones (presences) also when input matrix is
  quantitative. There are two types of quantitative data: Counts are
  integers with a natural unit so that individuals can be shuffled, but
  abundances can have real (floating point) values and do not have a
  natural subunit for shuffling. All quantitative models can handle
  counts, but only some are able to handle real values. Some of the null
  models are sequential so that the next matrix is derived from the
  current one. This makes models dependent from previous models, and usually
  you must thin these matrices and study the sequences for stability:
  see <code>oecosimu</code> for details and instructions.</p>
<p>See Examples for structural constraints imposed by each algorithm and
  defining your own null model.</p>
    </div>
    <div class="section level2">
    <h2 id="binary-null-models">Binary null models<a class="anchor" aria-label="anchor" href="#binary-null-models"></a></h2>


<p>All binary null models preserve fill: number of presences or
  conversely the number of absences. The classic models may also
  preserve column (species) frequencies (<code>c0</code>) or row frequencies
  or species richness of each site (<code>r0</code>) and take into account
  commonness and rarity of species (<code>r1</code>, <code>r2</code>).  Algorithms
  <code>swap</code>, <code>tswap</code>, <code>curveball</code>, <code>quasiswap</code> and
  <code>backtracking</code> preserve both row and column frequencies. Three
  first ones are sequential but the two latter are non-sequential
  and produce independent matrices. Basic algorithms are reviewed by
  Wright et al. (1998).</p>
<dl><dt><code>"r00"</code>: </dt>
<dd><p>non-sequential algorithm for binary matrices
    that only  preserves the number of presences (fill).</p></dd>


  <dt><code>"r0"</code>: </dt>
<dd><p>non-sequential algorithm for binary
    matrices that preserves the site (row) frequencies.</p></dd>


  <dt><code>"r1"</code>: </dt>
<dd><p>non-sequential algorithm for binary matrices
    that preserves the site (row) frequencies, but uses column marginal
    frequencies as probabilities of selecting species.</p></dd>


  <dt><code>"r2"</code>: </dt>
<dd><p>non-sequential algorithm for binary matrices
    that preserves the site (row) frequencies, and uses squared column
    marginal frequencies as as probabilities of selecting species.</p></dd>


  <dt><code>"c0"</code>: </dt>
<dd><p>non-sequential algorithm for binary matrices
    that preserves species frequencies (Jonsson 2001).</p></dd>


  <dt><code>"swap"</code>: </dt>
<dd><p>sequential algorithm for binary matrices that
    changes the matrix structure, but does not influence marginal sums
    (Gotelli &amp; Entsminger 2003).  This inspects \(2 \times 2\) submatrices so long that a swap can be done.</p></dd>


  <dt><code>"tswap"</code>: </dt>
<dd><p>sequential algorithm for binary matrices.
    Same as the <code>"swap"</code> algorithm, but it tries a fixed
    number of times and performs zero to many swaps at one step
    (according to the thin argument in the call). This
    approach was suggested by Miklós &amp; Podani (2004)
    because they found that ordinary swap may lead to biased
    sequences, since some columns or rows are more easily swapped.</p></dd>


  <dt><code>"curveball"</code>: </dt>
<dd><p>sequential method for binary matrices that
    implements the ‘Curveball’ algorithm of Strona et
    al. (2014). The algorithm selects two random rows and finds the set
    of unique species that occur only in one of these rows. The
    algorithm distributes the set of unique species to rows preserving
    the original row frequencies.  Zero to several species are swapped
    in one step, and usually the matrix is perturbed more strongly than
    in other sequential methods.</p></dd>


  <dt><code>"quasiswap"</code>: </dt>
<dd><p>non-sequential algorithm for binary
    matrices that implements a method where matrix is first filled
    honouring row and column totals, but with integers that may be
    larger than one.  Then the method inspects random
    \(2 \times 2\) matrices and performs a quasiswap on
    them. In addition to ordinary swaps, quasiswap can reduce numbers
    above one to ones preserving marginal totals (Miklós &amp;
    Podani 2004). The method is non-sequential, but it accepts
    <code>thin</code> argument: the convergence is checked at every
    <code>thin</code> steps. This allows performing several ordinary swaps in
    addition to fill changing swaps which helps in reducing or removing
    the bias.</p></dd>


  <dt><code>"greedyqswap"</code>: </dt>
<dd><p>A greedy variant of quasiswap. In
    greedy step, one element of the \(2 \times 2\) matrix is
    taken from \(&gt; 1\) elements. The greedy steps are biased, but
    the method can be thinned, and only the first of <code>thin</code>
    steps is greedy. Even modest thinning (say <code>thin = 20</code>)
    removes or reduces the bias, and <code>thin = 100</code> (1% greedy
    steps) looks completely safe and still speeds up simulation. The
    code is experimental and it is provided here for further scrutiny,
    and should be tested for bias before use.</p></dd>


  <dt><code>"backtracking"</code>: </dt>
<dd><p>non-sequential algorithm for binary
    matrices that implements a filling method with constraints both for
    row and column frequencies (Gotelli &amp; Entsminger 2001).  The matrix
    is first filled randomly, but typically row and column sums are
    reached before all incidences are filled in. After this begins
    "backtracking", where some of the incidences are removed, and
    filling is started again, and this backtracking is done so many
    times that all incidences will be filled into matrix.  The results
    may be biased and should be inspected carefully before use.</p></dd>



</dl></div>
    <div class="section level2">
    <h2 id="quantitative-models-for-counts-with-fixed-marginal-sums">Quantitative Models for Counts with Fixed Marginal Sums<a class="anchor" aria-label="anchor" href="#quantitative-models-for-counts-with-fixed-marginal-sums"></a></h2>


<p>These models shuffle individuals of counts and keep marginal sums
  fixed, but marginal frequencies are not preserved. Algorithm
  <code>r2dtable</code> uses standard <span style="R">R</span> function <code><a href="https://rdrr.io/r/stats/r2dtable.html" class="external-link">r2dtable</a></code> also
  used for simulated \(P\)-values in <code><a href="https://rdrr.io/r/stats/chisq.test.html" class="external-link">chisq.test</a></code>.
  Algorithm <code>quasiswap_count</code> uses the same, but preserves the
  original fill. Typically this means increasing numbers of zero cells
  and the result is zero-inflated with respect to <code>r2dtable</code>.</p>
<dl><dt><code>"r2dtable"</code>: </dt>
<dd><p>non-sequential algorithm for count
    matrices.  This algorithm keeps matrix sum and row/column sums
    constant. Based on <code><a href="https://rdrr.io/r/stats/r2dtable.html" class="external-link">r2dtable</a></code>.</p></dd>


  <dt><code>"quasiswap_count"</code>: </dt>
<dd><p>non-sequential algorithm for count
    matrices.  This algorithm is similar as Carsten Dormann's
    <code>swap.web</code> function in the package
    <span class="pkg">bipartite</span>. First, a random matrix is generated by the
    <code><a href="https://rdrr.io/r/stats/r2dtable.html" class="external-link">r2dtable</a></code> function preserving row and column sums.  Then
    the original matrix fill is reconstructed by sequential steps to
    increase or decrease matrix fill in the random matrix. These steps
    are based on swapping \(2 \times 2\) submatrices (see
    <code>"swap_count"</code> algorithm for details) to maintain row and
    column totals.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="quantitative-swap-models">Quantitative Swap Models<a class="anchor" aria-label="anchor" href="#quantitative-swap-models"></a></h2>


<p>Quantitative swap models are similar to binary <code>swap</code>, but they
  swap the largest permissible value. The models in this section all
  maintain the fill and perform a quantitative swap only if this can
  be done without changing the fill. Single step of swap often changes
  the matrix very little. In particular, if cell counts are variable,
  high values change very slowly. Checking the chain stability and
  independence is even more crucial than in binary swap, and very
  strong <code>thin</code>ning is often needed. These models should never be
  used without inspecting their properties for the current data. These
  null models can also be defined using <code><a href="permatfull.html">permatswap</a></code>
  function.</p>
<p></p><dl><dt><code>"swap_count"</code>: </dt>
<dd><p>sequential algorithm for count matrices.
    This algorithm find \(2 \times 2\) submatrices that can be
    swapped leaving column and row totals and fill unchanged. The
    algorithm finds the largest value in the submatrix that can be
    swapped (\(d\)). Swap means that the values in diagonal or
    antidiagonal positions are decreased by \(d\), while remaining
    cells are increased by \(d\). A swap is made only if fill does not
    change.</p></dd>


   <dt><code>"abuswap_r"</code>: </dt>
<dd><p>sequential algorithm for count or
    nonnegative real valued matrices with fixed row frequencies (see
    also <code><a href="permatfull.html">permatswap</a></code>).  The algorithm is similar to
    <code>swap_count</code>, but uses different swap value for each row of the
    \(2 \times 2\) submatrix. Each step changes the the
    corresponding column sums, but honours matrix fill, row sums, and
    row/column frequencies (Hardy 2008; randomization scheme 2x).</p></dd>


  <dt><code>"abuswap_c"</code>: </dt>
<dd><p>sequential algorithm for count or
    nonnegative real valued matrices with fixed column frequencies
    (see also <code><a href="permatfull.html">permatswap</a></code>).  The algorithm is similar as
    the previous one, but operates on columns.  Each step changes the
    the corresponding row sums, but honours matrix fill, column sums,
    and row/column frequencies (Hardy 2008; randomization scheme 3x).</p></dd>


</dl><p></p>
    </div>
    <div class="section level2">
    <h2 id="quantitative-swap-and-shuffle-models">Quantitative Swap and Shuffle Models<a class="anchor" aria-label="anchor" href="#quantitative-swap-and-shuffle-models"></a></h2>


<p>Quantitative Swap and Shuffle methods (<code>swsh</code> methods) preserve
  fill and column and row frequencies, and also either row or column
  sums. The methods first perform a binary <code>quasiswap</code> and then
  shuffle original quantitative data to non-zero cells. The
  <code>samp</code> methods shuffle original non-zero cell values and can be
  used also with non-integer data. The <code>both</code> methods
  redistribute individuals randomly among non-zero cells and can only
  be used with integer data. The shuffling is either free over the
  whole matrix, or within rows (<code>r</code> methods) or within columns
  (<code>c</code> methods). Shuffling within a row preserves row sums, and
  shuffling within a column preserves column sums. These models can
  also be defined with <code><a href="permatfull.html">permatswap</a></code>.</p>
<dl><dt><code>"swsh_samp"</code>: </dt>
<dd><p>non-sequential algorithm for
    quantitative data (either integer counts or non-integer values).
    Original non-zero values values are shuffled.</p></dd>


  <dt><code>"swsh_both"</code>: </dt>
<dd><p>non-sequential algorithm for count data.
    Individuals are shuffled freely over non-zero cells.</p></dd>


  <dt><code>"swsh_samp_r"</code>: </dt>
<dd><p>non-sequential algorithm for
    quantitative data.  Non-zero values (samples) are shuffled
    separately for each row.</p></dd>


  <dt><code>"swsh_samp_c"</code>: </dt>
<dd><p>non-sequential algorithm for
    quantitative data.  Non-zero values (samples) are shuffled
    separately for each column.</p></dd>


  <dt><code>"swsh_both_r"</code>: </dt>
<dd><p>non-sequential algorithm for count matrices.
    Individuals are shuffled freely for non-zero values within each row.</p></dd>


  <dt><code>"swsh_both_c"</code>: </dt>
<dd><p>non-sequential algorithm for count matrices.
    Individuals are shuffled freely for non-zero values with each column.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="quantitative-shuffle-methods">Quantitative Shuffle Methods<a class="anchor" aria-label="anchor" href="#quantitative-shuffle-methods"></a></h2>


<p>Quantitative shuffle methods are generalizations of binary models
  <code>r00</code>, <code>r0</code> and <code>c0</code>.  The <code>_ind</code> methods
  shuffle individuals so that the grand sum, row sum or column sums
  are preserved.  These methods are similar as <code>r2dtable</code> but
  with still slacker constraints on marginal sums. The <code>_samp</code>
  and <code>_both</code> methods first apply the corresponding binary model
  with similar restriction on marginal frequencies and then distribute
  quantitative values over non-zero cells. The <code>_samp</code> models
  shuffle original cell values and can therefore handle also non-count
  real values. The <code>_both</code> models shuffle individuals among
  non-zero values. The shuffling is over the whole matrix in
  <code>r00_</code>, and within row in <code>r0_</code> and within column in
  <code>c0_</code> in all cases.</p>
<dl><dt><code>"r00_ind"</code>: </dt>
<dd><p>non-sequential algorithm for count matrices.
    This algorithm preserves grand sum and
    individuals are shuffled among cells of the matrix.</p></dd>


  <dt><code>"r0_ind"</code>: </dt>
<dd><p>non-sequential algorithm for count matrices.
    This algorithm preserves row sums and
    individuals are shuffled among cells of each row of the matrix.</p></dd>


  <dt><code>"c0_ind"</code>: </dt>
<dd><p>non-sequential algorithm for count matrices.
    This algorithm preserves column sums and
    individuals are shuffled among cells of each column of the matrix.</p></dd>


  <dt><code>"r00_samp"</code>: </dt>
<dd><p>non-sequential algorithm for count
    or nonnegative real valued (<code>mode = "double"</code>) matrices.
    This algorithm preserves grand sum and
    cells of the matrix are shuffled.</p></dd>


  <dt><code>"r0_samp"</code>: </dt>
<dd><p>non-sequential algorithm for count
    or nonnegative real valued (<code>mode = "double"</code>) matrices.
    This algorithm preserves row sums and
    cells within each row are shuffled.</p></dd>


  <dt><code>"c0_samp"</code>: </dt>
<dd><p>non-sequential algorithm for count
    or nonnegative real valued (<code>mode = "double"</code>) matrices.
    This algorithm preserves column sums constant and
    cells within each column are shuffled.</p></dd>


  <dt><code>"r00_both"</code>: </dt>
<dd><p>non-sequential algorithm for count matrices.
    This algorithm preserves grand sum and
    cells and individuals among cells of the matrix are shuffled.</p></dd>


  <dt><code>"r0_both"</code>: </dt>
<dd><p>non-sequential algorithm for count matrices.
    This algorithm preserves grand sum and
    cells and individuals among cells of each row are shuffled.</p></dd>


  <dt><code>"c0_both"</code>: </dt>
<dd><p>non-sequential algorithm for count matrices.
    This algorithm preserves grand sum and
    cells and individuals among cells of each column are shuffled.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>commsim</code> with elements
corresponding to the arguments (<code>method</code>, <code>binary</code>,
<code>isSeq</code>, <code>mode</code>, <code>fun</code>).</p>
<p>If the input of <code>make.comsimm</code> is a <code>commsim</code> object,
it is returned without further evaluation. If this is not the case,
the character <code>method</code> argument is matched against
predefined algorithm names. An error message is issued
if none such is found. If the <code>method</code> argument is missing,
the function returns names of all currently available
null model algorithms as a character vector.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Gotelli, N.J. &amp; Entsminger, N.J. (2001). Swap and fill algorithms in
  null model analysis: rethinking the knight's tour. <em>Oecologia</em>
  129, 281–291.</p>
<p>Gotelli, N.J. &amp; Entsminger, N.J. (2003). Swap algorithms in null model
  analysis. <em>Ecology</em> 84, 532–535.</p>
<p>Hardy, O. J. (2008) Testing the spatial phylogenetic structure of
  local communities: statistical performances of different null models
  and test statistics on a locally neutral community.  <em>Journal of
  Ecology</em> 96, 914–926.</p>
<p>Jonsson, B.G. (2001) A null model for randomization tests of
  nestedness in species assemblages. <em>Oecologia</em> 127, 309–313.</p>
<p>Miklós, I. &amp; Podani, J. (2004). Randomization of
  presence-absence matrices: comments and new algorithms. <em>Ecology</em>
  85, 86–92.</p>
<p>Patefield, W. M. (1981) Algorithm AS159.  An efficient method of
  generating r x c tables with given row and column totals.
  <em>Applied Statistics</em> 30, 91–97.</p>
<p>Strona, G., Nappo, D., Boccacci, F., Fattorini, S. &amp;
  San-Miguel-Ayanz, J. (2014). A fast and unbiased procedure to
  randomize ecological binary matrices with fixed row and column
  totals. <em>Nature Communications</em> 5:4114
  <a href="https://doi.org/10.1038/ncomms5114" class="external-link">doi:10.1038/ncomms5114</a>
.</p>
<p>Wright, D.H., Patterson, B.D., Mikkelson, G.M., Cutler, A. &amp; Atmar,
  W. (1998). A comparative analysis of nested subset patterns of species
  composition. <em>Oecologia</em> 113, 1–20.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Jari Oksanen and Peter Solymos</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>See <code><a href="permatfull.html">permatfull</a></code>, <code><a href="permatfull.html">permatswap</a></code> for
alternative specification of quantitative null models. Function
<code><a href="oecosimu.html">oecosimu</a></code> gives a higher-level interface for applying null
models in hypothesis testing and analysis of models. Function
<code><a href="nullmodel.html">nullmodel</a></code> and <code><a href="nullmodel.html">simulate.nullmodel</a></code> are used to
generate arrays of simulated null model matrices.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## write the r00 algorithm</span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span>, <span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">cs</span> <span class="op">&lt;-</span> <span class="fu">commsim</span><span class="op">(</span><span class="st">"r00"</span>, fun<span class="op">=</span><span class="va">f</span>, binary<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    isSeq<span class="op">=</span><span class="cn">FALSE</span>, mode<span class="op">=</span><span class="st">"integer"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An object of class “commsim” </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ‘r00’ method (binary, non-sequential, integer mode)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## retrieving the sequential swap algorithm</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">cs</span> <span class="op">&lt;-</span> <span class="fu">make.commsim</span><span class="op">(</span><span class="st">"swap"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An object of class “commsim” </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ‘swap’ method (binary, sequential, integer mode)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## feeding a commsim object as argument</span></span></span>
<span class="r-in"><span><span class="fu">make.commsim</span><span class="op">(</span><span class="va">cs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An object of class “commsim” </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ‘swap’ method (binary, sequential, integer mode)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## making the missing c1 model using r1 as a template</span></span></span>
<span class="r-in"><span><span class="co">##   non-sequential algorithm for binary matrices</span></span></span>
<span class="r-in"><span><span class="co">##   that preserves the species (column) frequencies,</span></span></span>
<span class="r-in"><span><span class="co">##   but uses row marginal frequencies</span></span></span>
<span class="r-in"><span><span class="co">##   as probabilities of selecting sites</span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">n</span>, <span class="va">nr</span>, <span class="va">nc</span>, <span class="va">rs</span>, <span class="va">cs</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0L</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nr</span>, <span class="va">nc</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/mode.html" class="external-link">storage.mode</a></span><span class="op">(</span><span class="va">rs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"double"</span></span></span>
<span class="r-in"><span>    <span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">J</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="va">out</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">nr</span>, <span class="va">cs</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, prob <span class="op">=</span> <span class="va">rs</span><span class="op">)</span>, <span class="va">j</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1L</span></span></span>
<span class="r-in"><span>    <span class="va">out</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">cs</span> <span class="op">&lt;-</span> <span class="fu">make.commsim</span><span class="op">(</span><span class="st">"r1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cs</span><span class="op">$</span><span class="va">method</span> <span class="op">&lt;-</span> <span class="st">"c1"</span></span></span>
<span class="r-in"><span><span class="va">cs</span><span class="op">$</span><span class="va">fun</span> <span class="op">&lt;-</span> <span class="va">f</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## structural constraints</span></span></span>
<span class="r-in"><span><span class="va">diagfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        rowSums <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        colSums <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        rowFreq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        colFreq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">evalfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">meth</span>, <span class="va">x</span>, <span class="va">n</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="nullmodel.html">nullmodel</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">meth</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">m</span>, nsim<span class="op">=</span><span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>        <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu">diagfun</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"data"</span><span class="op">)</span>, <span class="va">y</span><span class="op">[</span>,,<span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"binary"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"isSeq"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"mode"</span><span class="op">)</span> <span class="op">==</span> <span class="st">"double"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"binary"</span>, <span class="st">"isSeq"</span>, <span class="st">"double"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">z</span>, <span class="va">out</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">10</span><span class="op">*</span><span class="fl">12</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">10</span><span class="op">*</span><span class="fl">12</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fl">12</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">algos</span> <span class="op">&lt;-</span> <span class="fu">make.commsim</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">algos</span>, <span class="va">evalfun</span>, x<span class="op">=</span><span class="va">x</span>, n<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">as.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">a</span><span class="op">==</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>, zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 binary isSeq double sum fill rowSums colSums rowFreq colFreq</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> r00                  1     .      .   1    1       .       .       .       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c0                   1     .      .   1    1       .       1       .       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> r0                   1     .      .   1    1       1       .       1       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> r1                   1     .      .   1    1       1       .       1       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> r2                   1     .      .   1    1       1       .       1       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> quasiswap            1     .      .   1    1       1       1       1       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> greedyqswap          1     .      .   1    1       1       1       1       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> swap                 1     1      .   1    1       1       1       1       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> tswap                1     1      .   1    1       1       1       1       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> curveball            1     1      .   1    1       1       1       1       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> backtrack            1     .      .   1    1       1       1       1       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> r2dtable             .     .      .   1    .       1       1       .       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> swap_count           .     1      .   1    1       1       1       .       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> quasiswap_count      .     .      .   1    1       1       1       .       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> swsh_samp            .     .      1   1    1       .       .       1       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> swsh_both            .     .      .   1    1       .       .       1       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> swsh_samp_r          .     .      1   1    1       1       .       1       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> swsh_samp_c          .     .      1   1    1       .       1       1       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> swsh_both_r          .     .      .   1    1       1       .       1       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> swsh_both_c          .     .      .   1    1       .       1       1       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> abuswap_r            .     1      1   1    1       1       .       1       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> abuswap_c            .     1      1   1    1       .       1       1       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> r00_samp             .     .      1   1    1       .       .       .       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c0_samp              .     .      1   1    1       .       1       .       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> r0_samp              .     .      1   1    1       1       .       1       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> r00_ind              .     .      .   1    .       .       .       .       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c0_ind               .     .      .   1    .       .       1       .       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> r0_ind               .     .      .   1    .       1       .       .       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> r00_both             .     .      .   1    1       .       .       .       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c0_both              .     .      .   1    1       .       1       .       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> r0_both              .     .      .   1    1       1       .       1       .</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jari Oksanen, Gavin L. Simpson, F. Guillaume Blanchet, Roeland Kindt, Pierre Legendre, Peter R. Minchin, R.B. O’Hara, Peter Solymos, M. Henry H. Stevens, Eduard Szoecs, Helene Wagner, Matt Barbour, Michael Bedward, Ben Bolker, Daniel Borcard, Gustavo Carvalho, Michael Chirico, Miquel De Caceres, Sebastien Durand, Heloisa Beatriz Antoniazi Evangelista, Rich FitzJohn, Michael Friendly, Brendan Furneaux, Geoffrey Hannigan, Mark O. Hill, Leo Lahti, Dan McGlinn, Marie-Helene Ouellette, Eduardo Ribeiro Cunha, Tyler Smith, Adrian Stier, Cajo J.F. Ter Braak, James Weedon.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

